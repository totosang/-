<!DOCTYPE html> <html lang="th"> <head> <meta charset="UTF-8"> <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≠‡∏ô</title> <script src="https://cdn.tailwindcss.com"></script> <style>body{background:#18181b}.pink-theme{background-color:#f72e8c}.pink-text{color:#f72e8c}.locked{background:#333!important;color:#fff!important;border:2px solid #f72e8c!important}.school-input{background:0 0;border:none;border-bottom:2px solid #f72e8c;color:#fff;font-size:1.2rem;text-align:center;outline:0;margin-top:4px;margin-bottom:16px}.table-cell{min-width:120px;position:relative}.drag-over{outline:2px dashed #f72e8c}.corner-badge{position:absolute;right:4px;bottom:4px;background:#16a34a;color:#fff;font-size:.9rem;font-weight:700;border-radius:6px;padding:2px 6px;pointer-events:none}.import-btn{display:none}.editable{cursor:pointer;text-decoration:underline}.editbox{color:#222;background:#fff;border-radius:3px;border:1px solid #16a34a;width:95%}.teacher-popup{position:absolute;top:28px;left:10px;z-index:20;background:#fff;color:#222;border-radius:6px;box-shadow:0 6px 18px 0 rgba(0,0,0,.15);padding:4px 10px}</style> </head> <body class="min-h-screen text-white flex flex-col items-center py-8"> <header class="mb-2 w-full flex flex-col items-center"> <h1 class="text-4xl font-extrabold pink-text">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≠‡∏ô</h1> <input class="school-input w-80" id="schoolName" placeholder="....................."> </header> <nav class="flex mb-4 gap-2"> <button id="tabSchedule" class="bg-pink-700 px-4 py-2 rounded-t font-bold">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≠‡∏ô</button> <button id="tabSubject" class="bg-gray-700 px-4 py-2 rounded-t font-bold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</button> <button id="tabTeacher" class="bg-gray-700 px-4 py-2 rounded-t font-bold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π</button> <button id="tabSetting" class="bg-gray-700 px-4 py-2 rounded-t font-bold">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</button> </nav> <div class="flex w-full max-w-5xl justify-end mb-2 gap-2"> <button id="exportBtn" class="bg-pink-600 hover:bg-pink-500 px-4 py-2 rounded">Export</button> <label class="bg-pink-600 hover:bg-pink-500 px-4 py-2 rounded cursor-pointer"> Import <input type="file" id="importInput" class="import-btn" accept=".json"> </label> </div> <main class="w-full max-w-5xl rounded-b-xl shadow-xl overflow-hidden bg-gray-900 p-4"> <section id="pageSchedule"> <div class="mb-2 flex items-center gap-2"> <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label> <select id="selectGrade" class="text-black p-1 rounded"> <option>‡∏≠.2</option> <option>‡∏≠.3</option> <option selected>‡∏õ.1</option> <option>‡∏õ.2</option> <option>‡∏õ.3</option> <option>‡∏õ.4</option> <option>‡∏õ.5</option> <option>‡∏õ.6</option> </select> <button class="bg-pink-700 px-3 py-1 rounded font-bold" id="clearScheduleBtn">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button> <button class="bg-pink-600 px-3 py-1 rounded font-bold" id="autoArrangeBtn">‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</button> </div> <div id="scheduleTableBox" class="overflow-x-auto mb-4"></div> <h2 class="text-xl font-bold pink-text mb-2">‡∏•‡∏≤‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏≤‡∏£‡∏≤‡∏á</h2> <div id="subjectBoxList" class="flex flex-wrap gap-2 mb-2"></div> </section> <section id="pageSubject" class="hidden"> <h2 class="text-xl font-bold pink-text mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</h2> <form id="formSubject" class="flex flex-wrap gap-2 mb-4"> <input type="text" id="subjectCode" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤" class="p-1 rounded text-black"> <input type="text" id="subjectName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤" class="p-1 rounded text-black" required> <input type="number" min="1" max="10" id="subjectHour" placeholder="‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå" class="p-1 rounded text-black w-28" required> <select id="subjectGrade" class="p-1 rounded text-black"> <option>‡∏≠.2</option><option>‡∏≠.3</option> <option>‡∏õ.1</option><option>‡∏õ.2</option><option>‡∏õ.3</option> <option>‡∏õ.4</option><option>‡∏õ.5</option><option>‡∏õ.6</option> </select> <select id="subjectTeacher" class="p-1 rounded text-black"></select> <button type="submit" class="bg-pink-700 px-3 py-1 rounded">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button> </form> <table class="min-w-full border border-gray-700 text-center bg-gray-800 rounded-xl"> <thead class="bg-pink-700"> <tr> <th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤</th><th>‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</th><th>‡∏ä‡∏±‡πâ‡∏ô</th><th>‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô</th><th>‡∏•‡πá‡∏≠‡∏Å</th><th>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th><th>‡∏•‡∏ö</th> </tr> </thead> <tbody id="subjectTable"></tbody> </table> </section> <section id="pageTeacher" class="hidden"> <h2 class="text-xl font-bold pink-text mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π</h2> <form id="formTeacher" class="flex flex-wrap gap-2 mb-4"> <input type="text" id="teacherName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π" class="p-1 rounded text-black" required> <button type="submit" class="bg-pink-700 px-3 py-1 rounded">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button> </form> <table class="min-w-full border border-gray-700 text-center bg-gray-800 rounded-xl"> <thead class="bg-pink-700"> <tr> <th>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π</th><th>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th><th>‡∏•‡∏ö</th> </tr> </thead> <tbody id="teacherTable"></tbody> </table> </section> <section id="pageSetting" class="hidden"> <h2 class="text-xl font-bold pink-text mb-2">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á</h2> <form id="conditionForm" class="mb-3 flex gap-2 flex-wrap"> <input type="text" id="conditionDesc" placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç" class="p-1 rounded text-black"> <button type="submit" class="bg-pink-700 px-3 py-1 rounded">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</button> </form> <ul id="conditionList" class="mb-4"></ul> <label class="block mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤:</label> <div class="mb-2"> <input type="checkbox" id="chkMorningMathSci" checked class="mr-1"> <label for="chkMorningMathSci">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå/‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏Ñ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ä‡πâ‡∏≤</label> </div> <div class="mb-2"> <input type="checkbox" id="chkAfternoonOthers" checked class="mr-1"> <label for="chkAfternoonOthers">‡∏ß‡∏¥‡∏ä‡∏≤‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏Ñ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏ä‡πà‡∏ß‡∏á‡∏ö‡πà‡∏≤‡∏¢</label> </div> <div class="mb-2"> <input type="checkbox" id="chkSubjectLock" checked class="mr-1"> <label for="chkSubjectLock">‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤/‡πÄ‡∏ß‡∏•‡∏≤</label> </div> <button class="bg-pink-700 px-4 py-2 rounded" id="saveSetting">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</button> </section> </main> <div id="toast" class="fixed bottom-6 right-6 bg-pink-700 text-white px-6 py-3 rounded-lg shadow-lg z-50 hidden"></div> <script>const periodTimes={"‡∏≠.2":["08:30-09:30","09:30-10:30","10:30-11:30","11:30-12:30","12:30-13:30","13:30-14:30","14:30-15:30"],"‡∏≠.3":["08:30-09:30","09:30-10:30","10:30-11:30","11:30-12:30","12:30-13:30","13:30-14:30","14:30-15:30"],"‡∏õ.1":["08:30-09:30","09:30-10:30","10:30-11:30","11:30-12:30","12:30-13:30","13:30-14:30","14:30-15:30"],default:["08:30-09:30","09:30-10:30","10:30-11:30","11:30-12:30","12:30-13:30","14:30-15:30","15:30-16:30"]},lunchPeriodIdx={"‡∏≠.2":2,"‡∏≠.3":2,"‡∏õ.1":3,default:4};function initDB(){return{school:"",teachers:["‡∏Ñ‡∏£‡∏π‡∏Å‡∏£‡∏£‡∏ò‡∏¥‡∏ç‡∏≤‡∏£‡πå ‡∏ô‡πâ‡∏≠‡∏¢‡∏î‡πâ‡∏ß‡∏á","‡∏Ñ‡∏£‡∏π‡∏≠‡∏≥‡∏û‡∏£‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏™‡∏∏‡∏ô‡∏ó‡∏£‡∏ä‡∏∑‡πà‡∏ô","‡∏Ñ‡∏£‡∏π‡∏õ‡∏ì‡∏±‡∏ä‡∏™‡∏£ ‡∏Æ‡∏∞‡∏°‡∏ì‡∏µ","‡∏Ñ‡∏£‡∏π‡∏®‡∏®‡∏¥‡∏ò‡∏≤‡∏£‡∏µ ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏î‡∏µ","‡∏Ñ‡∏£‡∏π‡∏ß‡∏ä‡∏¥‡∏£‡∏∞‡∏û‡∏±‡∏ô‡∏ò‡πå ‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏°‡∏ì‡∏µ","‡∏Ñ‡∏£‡∏π‡πÅ‡∏™‡∏á‡∏î‡∏≤‡∏ß ‡πÄ‡∏ä‡∏¥‡∏î‡∏ä‡∏¥‡∏î","‡∏Ñ‡∏£‡∏π‡∏Å‡∏ô‡∏Å‡∏≠‡∏£ ‡πÑ‡∏ä‡∏¢‡πÄ‡∏•‡∏¥‡∏®","‡∏Ñ‡∏£‡∏π‡∏ò‡∏ô‡∏Å‡∏§‡∏ï ‡πÅ‡∏á‡πà‡∏û‡∏£‡∏´‡∏°","‡∏Ñ‡∏£‡∏π‡∏™‡∏∏‡∏ó‡∏±‡∏®‡∏ô‡πå ‡∏™‡∏∏‡∏Ç‡∏ó‡∏≠‡∏á"],subjects:[{code:"‡∏ó11101",name:"‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢",hour:5,grade:"‡∏õ.1",teacher:"‡∏Ñ‡∏£‡∏π‡∏õ‡∏ì‡∏±‡∏ä‡∏™‡∏£ ‡∏Æ‡∏∞‡∏°‡∏ì‡∏µ",lock:!1},{code:"‡∏Ñ11101",name:"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",hour:5,grade:"‡∏õ.1",teacher:"‡∏Ñ‡∏£‡∏π‡∏õ‡∏ì‡∏±‡∏ä‡∏™‡∏£ ‡∏Æ‡∏∞‡∏°‡∏ì‡∏µ",lock:!1}],schedules:{},setting:{morningMathSci:!0,afternoonOthers:!0,subjectLock:!0,customConditions:[]}}}const DB={save:()=>localStorage.setItem("scheduleDB",JSON.stringify(window.scheduleDB)),load:()=>{let a=localStorage.getItem("scheduleDB");window.scheduleDB=a?JSON.parse(a):initDB()}};DB.load();function showTab(a){document.querySelectorAll("main > section").forEach(b=>b.classList.add("hidden")),document.getElementById(a).classList.remove("hidden"),document.querySelectorAll("nav button").forEach(b=>b.classList.remove("bg-pink-700")),document.querySelector(`[id=tab${a.replace("page","")}]`).classList.add("bg-pink-700"),"pageSubject"==a&&(fillTeacherSelect(),renderSubjectTable()),"pageSchedule"==a&&(renderSchedule(),renderSubjectBoxList()),"pageTeacher"==a&&renderTeacherTable(),"pageSetting"==a&&renderConditionList()}document.getElementById("tabSchedule").onclick=()=>showTab("pageSchedule"),document.getElementById("tabSubject").onclick=()=>showTab("pageSubject"),document.getElementById("tabTeacher").onclick=()=>showTab("pageTeacher"),document.getElementById("tabSetting").onclick=()=>showTab("pageSetting");let schoolName=document.getElementById("schoolName");function renderTeacherTable(){let a=document.getElementById("teacherTable");a.innerHTML="",window.scheduleDB.teachers.forEach((b,c)=>{a.innerHTML+=`<tr><td>${b}</td><td><button onclick="editTeacher(${c})" class="bg-yellow-500 px-2 py-1 rounded">‚úèÔ∏è</button></td><td><button onclick="deleteTeacher(${c})" class="bg-red-500 px-2 py-1 rounded">üóëÔ∏è</button></td></tr>`})}function fillTeacherSelect(){let a=document.getElementById("subjectTeacher");a.innerHTML="",window.scheduleDB.teachers.forEach(b=>{a.innerHTML+=`<option>${b}</option>`})}schoolName.value=window.scheduleDB.school,schoolName.oninput=()=>{window.scheduleDB.school=schoolName.value,DB.save()};let editingTeacher=-1;document.getElementById("formTeacher").onsubmit=function(a){a.preventDefault();const b=document.getElementById("teacherName").value.trim();b&&(editingTeacher>-1?window.scheduleDB.teachers[editingTeacher]=b:window.scheduleDB.teachers.push(b),DB.save(),renderTeacherTable(),fillTeacherSelect(),editingTeacher=-1,this.reset(),showToast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡πÅ‡∏•‡πâ‡∏ß"))},window.editTeacher=function(a){document.getElementById("teacherName").value=window.scheduleDB.teachers[a],editingTeacher=a},window.deleteTeacher=function(a){window.scheduleDB.teachers.splice(a,1),DB.save(),renderTeacherTable(),fillTeacherSelect(),showToast("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡πÅ‡∏•‡πâ‡∏ß")};function renderSubjectTable(){let a=document.getElementById("subjectTable");a.innerHTML="",window.scheduleDB.subjects.forEach((b,c)=>{a.innerHTML+=`<tr><td>${b.code||"-"}</td><td>${b.name}</td><td>${b.hour}</td><td>${b.grade}</td><td>${b.teacher}</td><td>${b.lock?"üîí":"-"}</td><td><button onclick="editSubject(${c})" class="bg-yellow-500 px-2 py-1 rounded">‚úèÔ∏è</button></td><td><button onclick="deleteSubject(${c})" class="bg-red-500 px-2 py-1 rounded">üóëÔ∏è</button></td></tr>`})}let editingSubject=-1;document.getElementById("formSubject").onsubmit=function(a){a.preventDefault();let b=document.getElementById("subjectCode").value.trim(),c=document.getElementById("subjectName").value.trim(),d=parseInt(document.getElementById("subjectHour").value),e=document.getElementById("subjectGrade").value,f=document.getElementById("subjectTeacher").value;if(!c||!d||!f)return;let g={code:b,name:c,hour:d,grade:e,teacher:f,lock:!1};editingSubject>-1?window.scheduleDB.subjects[editingSubject]=g:window.scheduleDB.subjects.push(g),DB.save(),renderSubjectTable(),renderSubjectBoxList(),editingSubject=-1,this.reset(),showToast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡πâ‡∏ß")},window.editSubject=function(a){let b=window.scheduleDB.subjects[a];document.getElementById("subjectCode").value=b.code,document.getElementById("subjectName").value=b.name,document.getElementById("subjectHour").value=b.hour,document.getElementById("subjectGrade").value=b.grade,document.getElementById("subjectTeacher").value=b.teacher,editingSubject=a},window.deleteSubject=function(a){window.scheduleDB.subjects.splice(a,1),DB.save(),renderSubjectTable(),renderSubjectBoxList(),showToast("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡πâ‡∏ß")};function countUsedSubject(a,b,c){let d=window.scheduleDB.schedules[a],e=0;if(!d)return 0;for(let f=0;f<5;f++)for(let g=0;g<7;g++)d[f]&&d[f][g]&&d[f][g].name===c&&e++;return e}function renderSubjectBoxList(){let a=document.getElementById("selectGrade").value,b=document.getElementById("subjectBoxList");b.innerHTML="",window.scheduleDB.subjects.filter(c=>c.grade==a).forEach(c=>{const d=countUsedSubject(a,c.code,c.name),e=c.hour-d;e>0&&(b.innerHTML+=`<div class="relative bg-pink-600 p-2 rounded shadow cursor-grab" draggable="true" data-idx="${window.scheduleDB.subjects.indexOf(c)}" ondragstart="dragSubject(event)" style="min-width:90px"><span class="font-bold">${c.code||"-"}</span><br><span class="text-xs">${c.name}</span><br><span class="text-xs">${c.teacher}</span>${c.hour>1?`<div class="corner-badge">${e}</div>`:""}</div>`)})}function renderSchedule(){let a=document.getElementById("selectGrade").value,b=a.startsWith("‡∏õ."),c=[{label:"‡∏Ñ‡∏≤‡∏ö 1",time:"08:30-09:30"},{label:"‡∏Ñ‡∏≤‡∏ö 2",time:"09:30-10:30"},{label:"‡∏Ñ‡∏≤‡∏ö 3",time:"10:30-11:30"},{label:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",time:"11:30-12:30",lunch:!0},{label:"‡∏Ñ‡∏≤‡∏ö 4",time:"12:30-13:30"},{label:"‡∏Ñ‡∏≤‡∏ö 5",time:"13:30-14:30"},{label:"‡∏Ñ‡∏≤‡∏ö 6",time:"14:30-15:30"},{label:"‡∏Ñ‡∏≤‡∏ö 7",time:"14:30-15:30"}],d='<table class="min-w-full border border-gray-700 text-center"><thead class="bg-pink-600"><tr><th>‡∏ß‡∏±‡∏ô/‡∏Ñ‡∏≤‡∏ö</th>';if(b)for(let e=0;e<c.length;e++){let f=c[e];if(f.lunch)d+=`<th class="table-cell bg-gray-900 text-green-400">${f.label}<br><span class="text-xs">${f.time}</span></th>`;else{let g="‡∏Ñ‡∏≤‡∏ö 7"===f.label?' style="color:yellow;font-weight:bold;"':"";d+=`<th class="table-cell"${g}>${f.label}<br><span class="text-xs">${f.time}</span></th>` }}else{let h=periodTimes[a]||periodTimes.default,i=void 0!==lunchPeriodIdx[a]?lunchPeriodIdx[a]:lunchPeriodIdx.default;for(let j=0;j<7;j++){let k=j+1;d+=j==i?`<th class="table-cell bg-gray-900 text-green-400">‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô<br><span class="text-xs">${h[j]}</span></th>`:`<th class="table-cell">‡∏Ñ‡∏≤‡∏ö ${k}<br><span class="text-xs">${h[j]}</span></th>` }}d+='</tr></thead><tbody class="bg-gray-800">',["‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡∏û‡∏∏‡∏ò","‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ","‡∏®‡∏∏‡∏Å‡∏£‡πå"].forEach((e,f)=>{if(d+=`<tr><td>${e}</td>`,b)for(let g=0;g<c.length;g++)c[g].lunch?d+='<td class="bg-gray-900 text-green-400">‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô</td>':d+=`<td id="cell-${f}-${g}" class="table-cell border border-gray-700" draggable="true" ondrop="dropSubject(event)" ondragover="allowDrop(event)" ondragstart="dragCell(event,${f},${g})"></td>`;else{let h=void 0!==lunchPeriodIdx[a]?lunchPeriodIdx[a]:lunchPeriodIdx.default;for(let i=0;i<7;i++)i==h?d+='<td class="bg-gray-900 text-green-400">‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô</td>':d+=`<td id="cell-${f}-${i}" class="table-cell border border-gray-700" draggable="true" ondrop="dropSubject(event)" ondragover="allowDrop(event)" ondragstart="dragCell(event,${f},${i})"></td>`}d+="</tr>"}),d+="</tbody></table>",document.getElementById("scheduleTableBox").innerHTML=d,fillScheduleTable()}function fillScheduleTable(){let a=document.getElementById("selectGrade").value,b=window.scheduleDB.schedules[a]||Array.from({length:5},()=>Array(7).fill(null));b.forEach((c,d)=>{c.forEach((e,f)=>{let g=document.getElementById(`cell-${d}-${f}`);g&&(e?(g.innerHTML=`<div class="bg-pink-400 rounded p-1 relative">${e.code||"-"}<br><span class="text-xs" style="display:block;line-height:1">${e.name||""}</span><span class="text-xs editable" onclick="showTeacherSelectInCell('${a}',${d},${f})" style="cursor:pointer;text-decoration:underline;">${e.teacher}</span></div>`,g.classList.toggle("locked",e.lock)):g.innerHTML="")})})}window.showTeacherSelectInCell=function(a,b,c){let d=document.getElementById(`cell-${b}-${c}`),e=window.scheduleDB.schedules[a]?.[b]?.[c];if(e){let f=window.scheduleDB.teachers.map(g=>`<option>${g}</option>`).join(""),h=`<div class="teacher-popup"><select id="popupTeacherSelect" style="color:#222" onchange="changeTeacherInCell('${a}',${b},${c},this.value)">${f}</select><button onclick="this.parentElement.remove()">‚úñ</button></div>`;d.querySelector(".teacher-popup")?.remove(),d.insertAdjacentHTML("beforeend",h),setTimeout(()=>document.getElementById("popupTeacherSelect").value=e.teacher,0)}},window.changeTeacherInCell=function(a,b,c,d){let e=window.scheduleDB.schedules[a][b][c];e&&d.trim()&&(e.teacher=d.trim(),window.scheduleDB.subjects.forEach(f=>{f.code==e.code&&f.name==e.name&&f.grade==a&&(f.teacher=d.trim())}),DB.save(),fillScheduleTable(),renderSubjectTable(),renderSubjectBoxList())},window.dragSubject=function(a){a.dataTransfer.setData("type","menu"),a.dataTransfer.setData("subjIdx",a.target.dataset.idx)},window.dragCell=function(a,b,c){a.dataTransfer.setData("type","cell"),a.dataTransfer.setData("cellRi",b),a.dataTransfer.setData("cellCi",c)},window.allowDrop=function(a){a.preventDefault(),a.currentTarget.classList.add("drag-over")},window.dropSubject=function(a){a.preventDefault(),a.currentTarget.classList.remove("drag-over");let b=document.getElementById("selectGrade").value,c=b.startsWith("‡∏õ."),d=a.currentTarget,[e,f]=d.id.replace("cell-","").split("-").map(Number);if(c&&3==f||!c&&f==lunchPeriodIdx[b])showToast("‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô");else{if(window.scheduleDB.schedules[b]||(window.scheduleDB.schedules[b]=Array.from({length:5},()=>Array(7).fill(null))),"menu"===a.dataTransfer.getData("type")){let g=a.dataTransfer.getData("subjIdx"),h=window.scheduleDB.subjects[g];if(countUsedSubject(b,h.code,h.name)>=h.hour)return void showToast("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß");if(window.scheduleDB.schedules[b][e][f])return void showToast("‡∏°‡∏µ‡∏ß‡∏¥‡∏ä‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß");window.scheduleDB.schedules[b][e][f]={code:h.code,name:h.name,teacher:h.teacher,lock:h.lock||!1}}else if("cell"===a.dataTransfer.getData("type")){let i=Number(a.dataTransfer.getData("cellRi")),j=Number(a.dataTransfer.getData("cellCi"));if(i==e&&j==f)return;let k=window.scheduleDB.schedules[b][i][j];window.scheduleDB.schedules[b][i][j]=window.scheduleDB.schedules[b][e][f],window.scheduleDB.schedules[b][e][f]=k}DB.save(),fillScheduleTable(),renderSubjectBoxList()}},document.getElementById("autoArrangeBtn").onclick=function(){let a=document.getElementById("selectGrade").value,b=window.scheduleDB.subjects.filter(c=>c.grade==a),c=a.startsWith("‡∏õ."),d=c?3:lunchPeriodIdx[a],e=Array.from({length:5},()=>Array(c?8:7).fill(null)),f=[];for(let g=0;g<5;g++)for(let h=0;h<(c?8:7);h++)c&&3==h||!c&&h===d||f.push({d:g,h:h});let i=["‡∏Ñ‡∏ì‡∏¥‡∏ï","mathematics","math","‡∏ß‡∏¥‡∏ó‡∏¢‡πå","science","science"],j=b.filter(k=>i.some(l=>k.name.toLowerCase().includes(l))),m=b.filter(k=>!i.some(l=>k.name.toLowerCase().includes(l))),n={};f.forEach(({d:o,h:p})=>{let q=c?p<3:p<d,r=q?j:m,s=null;for(let t of r){let u=n[t.name]||0;if(u<t.hour&&!e[o].some(v=>v&&v.name===t.name)){s=t;break}}if(!s){let w=j.concat(m);for(let x of w){let y=n[x.name]||0;if(y<x.hour&&!e[o].some(z=>z&&z.name===x.name)){s=x;break}}}s&&(e[o][p]={code:s.code,name:s.name,teacher:s.teacher,lock:s.lock||!1},n[s.name]=(n[s.name]||0)+1)}),window.scheduleDB.schedules[a]=e,DB.save(),fillScheduleTable(),renderSubjectBoxList(),showToast("‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")},document.getElementById("selectGrade").onchange=()=>{renderSchedule(),renderSubjectBoxList()},document.getElementById("clearScheduleBtn").onclick=()=>{let a=document.getElementById("selectGrade").value,b=a.startsWith("‡∏õ.");window.scheduleDB.schedules[a]=Array.from({length:5},()=>Array(b?8:7).fill(null)),DB.save(),fillScheduleTable(),renderSubjectBoxList(),showToast("‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß")},document.getElementById("exportBtn").onclick=()=>{const a=JSON.stringify(window.scheduleDB),b=new Blob([a],{type:"application/json"}),c=document.createElement("a");c.href=URL.createObjectURL(b),c.download="scheduleDB.json",c.click()},document.getElementById("importInput").onchange=function(a){const b=a.target.files[0];if(b){const c=new FileReader;c.onload=function(d){try{window.scheduleDB=JSON.parse(d.target.result),DB.save(),renderTeacherTable(),fillTeacherSelect(),renderSubjectTable(),renderSubjectBoxList(),renderSchedule(),renderConditionList(),showToast("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")}catch(e){showToast("‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î")}},c.readAsText(b)}},document.getElementById("conditionForm").onsubmit=function(a){a.preventDefault();const b=document.getElementById("conditionDesc").value.trim();b&&(window.scheduleDB.setting.customConditions=window.scheduleDB.setting.customConditions||[],window.scheduleDB.setting.customConditions.push(b),DB.save(),this.reset(),renderConditionList(),showToast("‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß"))},window.removeCondition=function(a){window.scheduleDB.setting.customConditions.splice(a,1),DB.save(),renderConditionList(),showToast("‡∏•‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß")},document.getElementById("saveSetting").onclick=a=>{a.preventDefault(),window.scheduleDB.setting.morningMathSci=document.getElementById("chkMorningMathSci").checked,window.scheduleDB.setting.afternoonOthers=document.getElementById("chkAfternoonOthers").checked,window.scheduleDB.setting.subjectLock=document.getElementById("chkSubjectLock").checked,DB.save(),showToast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")};function renderConditionList(){const a=document.getElementById("conditionList");a.innerHTML="",(window.scheduleDB.setting.customConditions||[]).forEach((b,c)=>{a.innerHTML+=`<li class="mb-1">${b} <button onclick="removeCondition(${c})" class="bg-red-500 px-2 py-1 rounded">‡∏•‡∏ö</button></li>`})}function showToast(a){const b=document.getElementById("toast");b.textContent=a,b.classList.remove("hidden"),setTimeout(()=>b.classList.add("hidden"),1800)}renderTeacherTable(),fillTeacherSelect(),renderSubjectTable(),renderSubjectBoxList(),renderSchedule(),renderConditionList();</script> </body> </html>
